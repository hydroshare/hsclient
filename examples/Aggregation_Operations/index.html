<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Aggregation Operations - hsclient</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../css/ansi-colours.css" rel="stylesheet" />
        <link href="../../css/jupyter-cells.css" rel="stylesheet" />
        <link href="../../css/pandas-dataframe.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Aggregation Operations";
        var mkdocs_page_input_path = "examples\\Aggregation_Operations.ipynb";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> hsclient
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Usage Examples</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../Basic_Operations/">Basic Operations</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Aggregation Operations</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#install-the-hsclient-python-client">Install the hsclient Python Client</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#authenticating-with-hydroshare">Authenticating with HydroShare</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#create-a-new-empty-resource">Create a New Empty Resource</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#resource-aggregation-handling">Resource Aggregation Handling</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#create-a-single-file-aggregation">Create a Single File Aggregation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#add-metadata-to-the-aggregation">Add Metadata to the Aggregation</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#title-and-keywords">Title and Keywords</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#extended-metadata-elements">Extended Metadata Elements</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#spatial-and-temporal-coverage">Spatial and Temporal Coverage</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#creating-other-aggregation-types">Creating Other Aggregation Types</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#geographic-feature-aggregation">Geographic Feature Aggregation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#geographic-raster-aggregation">Geographic Raster Aggregation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#multidimensional-netcdf-aggregation">Multidimensional NetCDF Aggregation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#time-series-aggregation">Time Series Aggregation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#file-set-aggregation">File Set Aggregation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#csv-aggregation">CSV Aggregation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#get-aggregation-properties">Get Aggregation Properties</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#searching-for-aggregations-within-a-resource">Searching for Aggregations within a Resource</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#downloading-an-aggregation">Downloading an Aggregation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#remove-and-delete-an-aggregation">Remove and Delete an Aggregation</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../File_Operations/">File Operations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Metadata_Operations/">Metadata Operations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Aggregation_Data_Object_Operations/">Aggregation Data Object Operations</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >API</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../api/hydroshare/">HydroShare</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/resource/">Resource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/file/">File</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/aggregation/">Aggregation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/netcdf_aggregation/">Multidimensional Aggregation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/geo_feature_aggregation/">Geographic Feature Aggregation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/geo_raster_aggregation/">Geographic Raster Aggregation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/time_series_aggregation/">Time Series Aggregation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/csv/">CSV Aggregation</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Models</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/ResourceMetadata/">Resource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/SingleFileMetadata/">Single File</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/FileSetMetadata/">File Set</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/GeographicFeatureMetadata/">Geographic Feature</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/GeographicRasterMetadata/">Geographic Raster</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/MultidimensionalMetadata/">Multidimensional</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/ReferencedTimeSeriesMetadata/">Referenced Time Series</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/TimeSeriesMetadata/">Time Series</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/ModelProgramMetadata/">Model Program</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/ModelInstanceMetadata/">Model Instance</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../metadata/CSVFileMetadata/">CSV</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">hsclient</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Usage Examples</li>
      <li class="breadcrumb-item active">Aggregation Operations</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/hydroshare/hsclient/edit/master/docs/examples/Aggregation_Operations.ipynb" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://mybinder.org/v2/gh/GitHub/master?urlpath=lab%2Ftree%2Fdocs\examples\Aggregation_Operations.ipynb"><img alt="Binder" src="https://mybinder.org/badge_logo.svg" /></a></p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="hsclient-hydroshare-python-client-resource-aggregation-operation-examples">hsclient HydroShare Python Client Resource Aggregation Operation Examples</h1>
<hr />
<p>The following code snippets show examples for how to use the hsclient HydroShare Python Client to manipulate aggregations of known content types in HydroShare. HydroShare's content type aggregations include individual file, fileset, time series, geographic feature, geographic raster, and multidimensional NetCDF.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="install-the-hsclient-python-client">Install the hsclient Python Client</h2>
<p>The hsclient Python Client for HydroShare may not be installed by default in your Python environment, so it has to be installed first before you can work with it. Use the following command to install hsclient via the Python Package Index (PyPi).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">!pip install hsclient
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="authenticating-with-hydroshare">Authenticating with HydroShare</h2>
<p>Before you start interacting with resources in HydroShare you will need to authenticate.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">from hsclient import HydroShare

hs = HydroShare()
hs.sign_in()
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="create-a-new-empty-resource">Create a New Empty Resource</h2>
<p>A "resource" is a container for your content in HydroShare. Think of it as a "working directory" into which you are going to organize the code and/or data you are using and want to share. The following code can be used to create a new, empty resource within which you can create content and metadata.</p>
<p>This code creates a new resource in HydroShare. It also creates an in-memory object representation of that resource in your local environment that you can then manipulate with further code.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Create the new, empty resource
new_resource = hs.create()

# Get the HydroShare identifier for the new resource
res_identifier = new_resource.resource_id
print(f'The HydroShare Identifier for your new resource is: {res_identifier}')

# Construct a hyperlink for the new resource
print(f'Your new resource is available at: {new_resource.metadata.url}')
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>The HydroShare Identifier for your new resource is: 570ff33346fc4a849a134c558bb8dcab
Your new resource is available at: http://localhost:8000/resource/570ff33346fc4a849a134c558bb8dcab
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="resource-aggregation-handling">Resource Aggregation Handling</h2>
<p>HydroShare allows you to create and manage aggregations of content files within resources that have specific types and associated metadata. These known content types include:</p>
<ul>
<li>Time series</li>
<li>Geographic feature</li>
<li>Geographic raster</li>
<li>Multidimensional NetCDF</li>
<li>Single file</li>
<li>File set</li>
<li>CSV</li>
</ul>
<p>The general process for creating an aggregation within a resource requires adding files to the resource and then applying the appropriate aggregation type. For some of the aggregation types, some of the aggregation metadata fields will be automatically extracted from the files you upload. You can then set the values of the other aggregation-level metadata elements. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="create-a-single-file-aggregation">Create a Single File Aggregation</h2>
<p>A single file aggregation in a HydroShare is any individual file to which you want to add extra metadata. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Import the aggregation types
from hsmodels.schemas.enums import AggregationType

# Upload a single content file to the resource. This is a generic text file.
new_resource.file_upload('Example_Files/Data_File1.txt')

# Specify the file you want to add the aggregation to
file = new_resource.file(path='Data_File1.txt')

# Create a single file aggregation on the file and refresh the resource
agg = new_resource.file_aggregate(file, AggregationType.SingleFileAggregation)

# Print the title for the aggregation that was added to the resource
print(f'The following aggregation was added to the resource: {agg.metadata.title}')
print(f'Aggregation type: {agg.metadata.type}')
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>The following aggregation was added to the resource: Data_File1
Aggregation type: Generic
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="add-metadata-to-the-aggregation">Add Metadata to the Aggregation</h3>
<p>Once you have created an aggregation, you can edit and add metadata elements. For a single file aggregation, you can add a title, subject keywords, extended metadata as key-value pairs, and spatial and temporal coverage. </p>
<p>All of the metadata edits are stored locally until you call the <code>save()</code> function on the aggregation to write the edits you have made to HydroShare.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="title-and-keywords">Title and Keywords</h4>
<p>The title of an aggregation is a string. Subject keywords are handled as a list of strings.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Set the title and subject keywords for the aggregation
agg.metadata.title = 'A Single File Aggregation'
agg.metadata.subjects = ['Aggregation', 'Single File', 'Text']

# Print the title and keywords for the aggregation
print(f'Aggregation Title: {agg.metadata.title}')
print(f'Aggregation Keywords: {&quot;, &quot;.join(agg.metadata.subjects)}')

# Save the aggregation to write the metadata to HydroShare
agg.save()
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="extended-metadata-elements">Extended Metadata Elements</h4>
<p>Extended metadata elements for an aggregation are handled using a Python dictionary. You can add new elements using key-value pairs.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Add an extended metadata element to the aggregation as a key-value pair
agg.metadata.additional_metadata['New Element Key'] = 'Text value of new element.'

# Remove an individual key-value pair from the aggregation using its key
del agg.metadata.additional_metadata['New Element Key']

# Or, you can clear out all extended metadata elements that might exist
agg.metadata.additional_metadata.clear()

# Add multiple key-value pairs to the aggregation at once using a Python dictionary
agg.metadata.additional_metadata = {
    'Observed Variable': 'Water use',
    'Site Location': 'Valley View Tower Dormitory on Utah State University\'s Campus in Logan, UT'
}

# Print the extended metadata elements
print('The extended metadata elements for the aggregation include:')
for key, value in agg.metadata.additional_metadata.items():
    print(key + ':', value)

# Save the aggregation to write the metadata to HydroShare
agg.save()
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="spatial-and-temporal-coverage">Spatial and Temporal Coverage</h4>
<p>Spatial and temporal coverage for an aggregation are handled in the same way they are handled for resource level metadata. Initially the spatial and temporal coverage for an aggregation are empty. To set them, you have to create a coverage object of the right type and set the spatial or temporal coverage to that object.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Import the required metadata classes for coverage objects
from hsmodels.schemas.fields import BoxCoverage, PointCoverage, PeriodCoverage
from datetime import datetime

# Set the spatial coverage of the aggregation to a BoxCoverage object
agg.metadata.spatial_coverage = BoxCoverage(name='Logan, Utah',
                                            northlimit=41.7910,
                                            eastlimit=-111.7664,
                                            southlimit=41.6732,
                                            westlimit=-111.9079,
                                            projection='WGS 84 EPSG:4326',
                                            type='box',
                                            units='Decimal degrees')

# You can remove the spatial coverage element by setting it to None
agg.metadata.spatial_coverage = None

# If you want to set the spatial coverage to a PointCoverage instead
agg.metadata.spatial_coverage = PointCoverage(name='Logan, Utah',
                                              north=41.7371,
                                              east=-111.8351,
                                              projection='WGS 84 EPSG:4326',
                                              type='point',
                                              units='Decimal degrees')

# Create a beginning and ending date for a time period
beginDate = datetime.strptime('2020-12-01T00:00:00Z', '%Y-%m-%dT%H:%M:%S%fZ')
endDate = datetime.strptime('2020-12-31T00:00:00Z', '%Y-%m-%dT%H:%M:%S%fZ')

# Set the temporal coverage of the aggregation to a PeriodCoverage object
agg.metadata.period_coverage = PeriodCoverage(start=beginDate, end=endDate)

# Print the temporal coverage information
print('Temporal Coverage:')
print(agg.metadata.period_coverage)

# Print the spatial coverage information
print('\nSpatial Coverage:')
print(agg.metadata.spatial_coverage)

# Save the aggregation to write the metadata to HydroShare
agg.save()
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="creating-other-aggregation-types">Creating Other Aggregation Types</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="geographic-feature-aggregation">Geographic Feature Aggregation</h3>
<p>Geographic feature aggregations are created in HydroShare from the set of files that make up an ESRI Shapefile. You need to upload the shapefile and then HydroShare will automatically set the aggregation on the set of files you upload. You can then retrieve the aggregation using its title or by searching for one of the files it contains.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Create a list of the files that make up the shapefile to be uploaded
file_list = ['Example_Files/watersheds.cpg', 'Example_Files/watersheds.dbf',
             'Example_Files/watersheds.prj', 'Example_Files/watersheds.sbn',
             'Example_Files/watersheds.sbx', 'Example_Files/watersheds.shp',
             'Example_Files/watersheds.shx', 'Example_Files/watersheds.shp.xml']

# Upload the files to the resource all at the same time
new_resource.file_upload(*file_list)

print('Files uploaded!')
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you upload all of the files of a shapefile together as shown above, HydroShare automatically recognizes the files as a shapefile and auto-aggregates the files into a geographic feature aggregation for you. So, you then just need to get the aggregation that was created if you want to further operate on it - e.g., to modify the aggregation-level metadata.</p>
<p>Metadata for a geographic feature aggregation includes a title, subject keywords, extended key-value pairs, temporal coverage, spatial coverage, geometry information, spatial reference, and attribute field information. When HydroShare creates the aggregation on the shapefile, the spatial coverage, geometry information, spatial reference, and attribute field information metadata will be automatically set for you. You can then set all of the other metadata elements as shown above for the single file aggregation if you need to.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Get the aggregation that was just created

# You can get the aggregation by searching for a file that is inside of it
agg = new_resource.aggregation(file__name='watersheds.shp')

# Or, you can get the aggregation by searching for its title, which is initially
# set to the name of the shapefile
agg = new_resource.aggregation(title='watersheds')

# Print the title for the aggregation that was added to the resource
print(f'The following aggregation was added to the resource: {agg.metadata.title}')
print(f'Aggregation type: {agg.metadata.type}')
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="geographic-raster-aggregation">Geographic Raster Aggregation</h3>
<p>Geographic raster aggregations are created in HydroShare from one or more raster data files that make up a raster dataset. HydroShare uses GeoTiff files for raster datasets. Like the geographic feature aggregation, when you upload all of the files for a geographic raster dataset (all .tif and a .vrt file) at once, HydroShare will automatically create the aggregation for you. You can then get the aggregation and set the other metadata elements as shown above for the single file aggregation.</p>
<p>HydroShare initially sets the title of the geographic raster aggregation to the first .tif file that appears in the .vrt file. The spatial coverage, spatial reference, and cell information are set automatically based on information extracted from the dataset. </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Upload the files making up the raster dataset to the resource
file_list = ['Example_Files/logan1.tif', 'Example_Files/logan2.tif', 'Example_Files/logan.vrt']
new_resource.file_upload(*file_list)

# Get the aggregation that was just created - initially the title will be &quot;logan1&quot;
# based on the name of the first .tif file that appears in the .vrt file
agg = new_resource.aggregation(title='logan1')

# Print the title for the aggregation that was added to the resource
print(f'The following aggregation was added to the resource: {agg.metadata.title}')
print(f'Aggregation type: {agg.metadata.type}')
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="multidimensional-netcdf-aggregation">Multidimensional NetCDF Aggregation</h3>
<p>Multidimensional aggregations are created in HydroShare from a NetCDF file. Like the other aggregation types, you can upload the NetCDF file and HydroShare will automatically create the aggregation for you. HydroShare also automatically extracts metadata from the NetCDF file to populate the aggregation metadata. Some of this metadata may get propagated to the resource level if you haven't set things like the title and keywords. You can then get the aggregation and set the other metadata elements as shown above for the single file aggregation.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Upload the NetCDF file to the resource
new_resource.file_upload('Example_Files/SWE_time.nc')

# Get the aggregation by searching for the NetCDF file that is inside of it
agg = new_resource.aggregation(file__name='SWE_time.nc')

# Print the title for the aggregation that was added to the resource
print(f'The following aggregation was added to the resource: {agg.metadata.title}')
print(f'Aggregation type: {agg.metadata.type}')
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="time-series-aggregation">Time Series Aggregation</h3>
<p>Time series aggregations are created in HydroShare from an ODM2 SQLite database file. The ODM2 SQLite database contain one or more time series </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Upload the SQLite file to the resource
new_resource.file_upload('Example_Files/ODM2.sqlite')

# Get the aggregation by searching for the SQLite file that is inside of it
agg = new_resource.aggregation(file__name='ODM2.sqlite')

# Print the title for the aggregation that was added to the resource
print(f'The following aggregation was added to the resource: {agg.metadata.title}')
print(f'Aggregation type: {agg.metadata.type}')
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="file-set-aggregation">File Set Aggregation</h3>
<p>A file set aggregation is any folder within a resource to which you want to add metadata. If you want to create a file set aggregation, you first have to create a folder, then upload files to it. After that, you can set the aggregation on the folder.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Create a new folder for the file set aggregation
new_resource.folder_create('Fileset_Aggregation')

# Add some files to the folder
new_resource.file_upload('Example_Files/Data_File1.txt', 'Example_Files/Data_File2.txt',
                         destination_path='Fileset_Aggregation')

# set the folder to fileset aggregation
new_resource.file_aggregate(path='Fileset_Aggregation', agg_type=AggregationType.FileSetAggregation)
fs_agg = new_resource.aggregation(type='FileSet')
print(f&quot;Aggregation Type: {fs_agg.metadata.type}&quot;)
</code></pre>


</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stdout output_text">
<pre>
<code>Aggregation Type: FileSet
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="csv-aggregation">CSV Aggregation</h2>
<p>CSV aggregations are created in HydroShare from a CSV file. When you upload a csv file, HydroShare automatically creates a CSV aggregation and extracts metadata from the uploaded CSV file.  </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Upload a CSV file to the resource
new_resource.file_upload('Example_Files/Data_File1.csv')

# Get the aggregation by searching for the CSV file
agg = new_resource.aggregation(file__name='Data_File1.csv')

# Print the title for the aggregation that was added to the resource
print(f&quot;The following aggregation was added to the resource: {agg.metadata.title}&quot;)
print(f&quot;Aggregation type: {agg.metadata.type}&quot;)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="get-aggregation-properties">Get Aggregation Properties</h2>
<p>Each aggregation in a resource has metadata properties associated with it. You can query/retrieve those properties for display. The following shows an example for the time series aggregation that was created above.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Get the time series aggregation that was created above
agg = new_resource.aggregation(type='TimeSeries')

# Print the metadata associated with the aggregation
print(f'Aggregation Title: {agg.metadata.title}')
print(f'Aggregation Type: {agg.metadata.type}')
print(f'Aggregation Keywords: {&quot;, &quot;.join(agg.metadata.subjects)}')
print(f'Aggregation Temporal Coverage: {agg.metadata.period_coverage}')
print(f'Aggregation Spatial Coverage: {agg.metadata.spatial_coverage}')

# Print the list of files in the aggregation
file_list = agg.files()
print('List of files contained within the aggregation:')
print(*file_list, sep='\n')
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><em>Example of editing extracted metadata for CSV aggregation</em></strong></p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Get the CSV aggregation you created above
agg = new_resource.aggregation(type=&quot;CSV&quot;)

# we can edit any extracted column properties (like 'title', 'description', 'datatype')
table = agg.metadata.tableSchema.table

# here is an example of editing the 'title' property of the 1st column
table.columns[0].title = &quot;Date of Observation&quot;

# here is an example of editing the 'description' of the 7th column
table.columns[6].description = &quot;Total Volume over time&quot;

# save the updated metadata
agg.save()
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="searching-for-aggregations-within-a-resource">Searching for Aggregations within a Resource</h2>
<p>If you need to find/get one or more aggregations within a resource so you can download or remove it from the resource, there are several filters available that allow you to return a list of aggregations that meet your search criteria.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Get the list of all aggregations in the resource
aggregations = new_resource.aggregations()

# Get a list of all aggregations of a particular type
aggregations = new_resource.aggregations(type=&quot;TimeSeries&quot;)

# Get a list of aggregations with extended metadata searching by key
aggregations = new_resource.aggregations(additional_metadata__key=&quot;Observed Variable&quot;)

# Get a list of aggregations with extended metadata searching by value
aggregations = new_resource.aggregations(additional_metadata__value=&quot;Water Use&quot;)

# Get a list of aggregations with a subject keyword searching by value
aggregations = new_resource.aggregations(subjects__contains=&quot;Temperature&quot;)

# Get a list of aggregations searching by title (or any metadata attribute)
aggregations = new_resource.aggregations(title=&quot;watersheds&quot;)

# Get a list of aggregations searching by a nested metadata attribute (__)
aggregations = new_resource.aggregations(period_coverage__name=&quot;period_coverage name&quot;)

# Get a list of aggregations by combining field searching, filtered with &quot;AND&quot;
aggregations = new_resource.aggregations(period_coverage__name=&quot;period_coverage name&quot;, title=&quot;watersheds&quot;)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also search for individual aggregations within a resource.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Search for an aggregation of type time series
aggregation = new_resource.aggregation(type=&quot;TimeSeries&quot;)

# Search for an aggregation with a specific title
aggregation = new_resource.aggregation(title=&quot;watersheds&quot;)

# Search for an aggregation that contains a particular file name
aggregation = new_resource.aggregation(file__name=&quot;ODM2.sqlite&quot;)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="downloading-an-aggregation">Downloading an Aggregation</h2>
<p>When working with a resource, you may want to download one of the aggregations contained within the resource. If you want to download it to a particular location on your disk, you can pass a path to the location where you want the aggregation to be saved to the <code>download()</code> function as a string. Aggregations are downloaded as a zipped file containing the aggregation content and metadata files.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Get the geographic feature aggregation that was created above
agg = new_resource.aggregation(title=&quot;watersheds&quot;)

# Download the aggregation
new_resource.aggregation_download(agg)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Clean up the zippled aggregation file that was just downloaded.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python">!rm 'watersheds.shp.zip'
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="remove-and-delete-an-aggregation">Remove and Delete an Aggregation</h2>
<p>You may wish to remove an aggregation from a resource. There are two functions you can use to do this. The difference between the two is whether the aggregation's content files are preserved in the resource or deleted. To remove the aggregation-specific metadata and associations while maintaining the content files, call the <code>remove()</code> function on the aggregation.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Get the geographic raster aggregation that was created above
agg = new_resource.aggregation(title=&quot;logan1&quot;)

# Remove the aggregation and delete its metadata, but leave the file(s)
new_resource.aggregation_remove(agg)
</code></pre>


</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you want to delete the aggregation, including its metadata and the associated content files, you can call the <code>delete()</code> function on the aggregation. Once you have called the <code>remove()</code> function on an aggregation, the <code>delete()</code> function will no longer work and you will have to delete the files individually.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">


<pre><code class="language-python"># Get the multidimensional NetCDF aggregation that was created above
agg = new_resource.aggregation(type=&quot;NetCDF&quot;)

# Delete the aggregation and metadata along with files within aggregation
new_resource.aggregation_delete(agg)
</code></pre>


</div>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../Basic_Operations/" class="btn btn-neutral float-left" title="Basic Operations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../File_Operations/" class="btn btn-neutral float-right" title="File Operations">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/hydroshare/hsclient" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../Basic_Operations/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../File_Operations/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
